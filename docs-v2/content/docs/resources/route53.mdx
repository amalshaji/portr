---
title: Using Route53 Instead of Cloudflare
description: Learn how to setup portr with AWS Route53 for DNS management
---

import { Steps } from 'fumadocs-ui/components/steps';
import { Callout } from 'fumadocs-ui/components/callout';

If you prefer to use AWS Route53 instead of Cloudflare for DNS management, you can configure Portr to work with Route53 for SSL certificate provisioning.

<Callout type="info">
  The [Caddy base image](https://github.com/amalshaji/caddy-docker-proxy) used by Portr is built with both Cloudflare and Route53 plugins.
</Callout>

## Setup Process

### Create an IAM Policy

Create an IAM policy using the template provided in [libdns/route53](https://github.com/libdns/route53#authenticating).

<Callout type="caution">
  Make sure you replace the hosted zone in the template with your actual hosted zone ID:

  ```diff
  - arn:aws:route53:::hostedzone/ZABCD1EFGHIL
  + arn:aws:route53:::hostedzone/<your-hosted-zone-id>
  ```
</Callout>

Here's the complete IAM policy template:

```json
{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Effect": "Allow",
            "Action": [
                "route53:GetChange"
            ],
            "Resource": [
                "arn:aws:route53:::change/*"
            ]
        },
        {
            "Effect": "Allow",
            "Action": [
                "route53:ChangeResourceRecordSets",
                "route53:ListResourceRecordSets"
            ],
            "Resource": [
                "arn:aws:route53:::hostedzone/<your-hosted-zone-id>"
            ]
        }
    ]
}
```

### Create an IAM User

1. Create a new IAM user in the AWS console
2. Attach the policy created in step 1 to this user
3. Note down the username for reference

### Generate Access Keys

1. Go to the user â†’ **Security credentials**
2. Click **Create access key**
3. Choose **Command Line Interface (CLI)** as the use case
4. Download or copy the access key ID and secret access key

### Update Environment Variables

Add the Route53 credentials to your `.env` file:

```diff title=".env"
- CLOUDFLARE_API_TOKEN=
+ ROUTE53_ACCESS_KEY=<access-key-id>
+ ROUTE53_SECRET_ACCESS_KEY=<secret-access-key>
```

### Update Docker Compose Configuration

Modify the Caddy labels in the tunnel service to use Route53 instead of Cloudflare:

```diff title="docker-compose.yaml"
labels:
  caddy_1: "*.$PORTR_DOMAIN"
  caddy_1.reverse_proxy: "{{upstreams http 8001}}"
-  caddy_1.tls.dns: "cloudflare $CLOUDFLARE_API_TOKEN"
+  caddy_1.tls.dns: "route53"
+  caddy_1.tls.dns.access_key_id: "$ROUTE53_ACCESS_KEY"
+  caddy_1.tls.dns.secret_access_key: "$ROUTE53_SECRET_ACCESS_KEY"
  caddy_1.encode: gzip
```

### Start the Services

Start your Portr services:

```bash
docker compose up -d
```

Navigate to your domain to verify the tunnel is working correctly.

## DNS Configuration

Make sure your Route53 hosted zone has the required DNS records:

| Type | Name | Value |
|------|------|-------|
| A    | @    | your-server-ipv4 |
| A    | *    | your-server-ipv4 |

## Security Considerations

- **Minimal permissions**: The IAM policy grants only the necessary permissions for DNS management
- **Dedicated user**: Use a dedicated IAM user for Portr, not your root AWS account
- **Key rotation**: Regularly rotate your access keys for enhanced security
- **Environment variables**: Never commit AWS credentials to version control

## Troubleshooting

### Certificate Issues

If SSL certificates aren't being issued:

1. **Verify permissions**: Ensure the IAM user has the correct permissions
2. **Check hosted zone**: Confirm the hosted zone ID is correct
3. **DNS propagation**: Wait for DNS changes to propagate (can take up to 48 hours)
4. **Review logs**: Check Caddy logs for detailed error messages

### Testing Your Setup

Verify your Route53 configuration:

```bash
# Check if DNS records are accessible
dig your-domain.com

# Test wildcard subdomain resolution
dig test.your-domain.com

# Verify SSL certificate
openssl s_client -connect your-domain.com:443 -servername your-domain.com
```

## Cost Considerations

Route53 pricing includes:
- **Hosted zone**: $0.50 per hosted zone per month
- **DNS queries**: $0.40 per million queries for the first 1 billion queries
- **Health checks**: Additional costs if you use Route53 health checks

For most Portr deployments, the DNS costs will be minimal.
